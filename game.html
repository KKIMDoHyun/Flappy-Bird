<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>flappybird game</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 336,
        height: 483,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 300 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var bird;
    var platforms;
    var JumpKey;
    var gameOver;
    var gameStarted;
    var game = new Phaser.Game(config);
    var framesMove = 0;
    var player;
    var cursors;
    var space;
    
    function preload ()
    {
        //배경 및 땅
        this.load.image('background', 'images/1.png');
        this.load.spritesheet('ground', 'images/ground-sprite.png', {
            frameWidth: 336,
            frameHeight: 112
        });

        //시작화면
        this.load.image('Initial_Message', 'images/initial-message.png')

        //파이프
        this.load.image('up_pipe', 'images/bg_pillarUp.png');
        this.load.image('down_pipe', 'images/bg_pillarDown.png');

        //새
        this.load.spritesheet('bird', 'images/birdbird1.png', {
            frameWidth: 40,
            frameHeight: 29
        });
    
        //숫자
        this.load.image('number0', 'images/num0.bmp');
        this.load.image('number1', 'images/num1.bmp');
        this.load.image('number2', 'images/num2.bmp');
        this.load.image('number3', 'images/num3.bmp');
        this.load.image('number4', 'images/num4.bmp');
        this.load.image('number5', 'images/num5.bmp');
        this.load.image('number6', 'images/num6.bmp');
        this.load.image('number7', 'images/num7.bmp');
        this.load.image('number8', 'images/num8.bmp');
        this.load.image('number9', 'images/num9.bmp');
    }

    function create ()
    {
        background = this.add.image(168, 241, 'background').setInteractive();

        //파이프
        // pipeGroup = this.physics.add.group();
        // pipeGroup.create(400, 0, 'up_pipe');
        // pipeGroup.create(400, 656, 'down_pipe');
        

        ground = this.physics.add.sprite(168, 300, 'ground');
        ground.setCollideWorldBounds(true);
        ground.setDepth(10);

        Initial_Message = this.add.image(168, 161, 'Initial_Message');
        Initial_Message.setDepth(30);
        Initial_Message.visible = false;

        space = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
        
        //땅 움직임
        this.anims.create({
            key: 'ground-moving',
            frames: this.anims.generateFrameNumbers('ground', {
                start: 0,
                end: 2
            }),
            frameRate: 15,
            repeat: -1
        })
        this.anims.create({
            key: 'ground-stop',
            frames: [{
                key: 'ground',
                frame: 0
            }],
            frameRate: 20
        })
        
        //새 움직임
        this.anims.create({
            key: 'bird-fly',
            frames: this.anims.generateFrameNumbers('bird', { 
                start: 0, 
                end: 2 
            }),
            frameRate: 10,
            repeat: -1
        });
        this.anims.create({
            key: 'bird-stop',
            frames: [{
                key: 'bird',
                frame: 1
            }],
            frameRate: 20
        })

        PrepareGame(this);
        
    }

    function update ()
    {
        if(Phaser.Input.Keyboard.JustDown(space)){
            moveBird();
        }
    
    }

    function PrepareGame(scene){
        framesMove = 0;
        gameOver = false;
        Initial_Message.visible = true;

        player = scene.physics.add.sprite(60, 200, 'bird');
        player.setCollideWorldBounds(true);
        player.anims.play('bird-fly', true);
        player.body.allowGravity = false;
        

        scene.physics.add.collider(player, ground, hitBird, null, scene)
        
        ground.anims.play('ground-moving', true);

    }

    function moveBird(){
        if (!gameStarted){
            startGame(game.scene.scenes[0])
        }
        player.setVelocityY(-350);
        player.angle = -15;
        // framesMove = 5;
    }

    function hitBird(player){
        this.physics.pause();

        gameOver = true;
        gameStarted = false;

        player.anims.play('bird-stop');
        ground.anims.play('ground-stop');
    }

    function startGame(scene) {
        gameStarted = true
        Initial_Message.visible = false
        player.body.allowGravity = true;
        player.body.setGravityY(900);
    }

</script>

</body>
</html>